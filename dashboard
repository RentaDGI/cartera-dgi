<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard DGI — RentaDGI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script>
tailwind.config = {
theme: {
    extend: {
        colors: {
            primary: '#1e40af',
            secondary: '#059669',
            accent: '#3b82f6',
        }
    }
}
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
body { 
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
    background: linear-gradient(135deg, #f5f7fa 0%, #e8edf2 100%);
    min-height: 100vh; 
}
.dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
.stats-card { 
    background: white; 
    border-radius: 16px; 
    padding: 24px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    transition: all 0.3s ease;
    border: 1px solid rgba(30, 64, 175, 0.1);
}
.stats-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 12px 35px rgba(0,0,0,0.15); 
    border-color: rgba(30, 64, 175, 0.2);
}
.main-table-card { 
    background: white; 
    border-radius: 16px; 
    padding: 32px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    margin-top: 24px;
    border: 1px solid rgba(30, 64, 175, 0.1);
}
.table { width: 100%; border-collapse: separate; border-spacing: 0; }
.table thead th { 
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%); 
    color: white; 
    font-weight: 600; 
    text-align: left; 
    padding: 16px 12px; 
    font-size: 0.875rem; 
    text-transform: uppercase; 
    letter-spacing: 0.05em; 
    border: none; 
    user-select: none; 
    position: relative; 
}
.table thead th.sortable { cursor: pointer; }
.table thead th.sortable:hover { background: linear-gradient(135deg, #1e40af 0%, #2563eb 50%, #3b82f6 100%); }
.table thead th.sortable::after { content: '⇅'; position: absolute; right: 8px; opacity: 0.3; font-size: 0.875rem; }
.table thead th.sort-asc::after { content: '↑'; opacity: 1; color: #10b981; }
.table thead th.sort-desc::after { content: '↓'; opacity: 1; color: #ef4444; }
.table thead th:first-child { border-top-left-radius: 12px; }
.table thead th:last-child { border-top-right-radius: 12px; }
.table tbody tr { transition: all 0.2s ease; border-bottom: 1px solid #e5e7eb; }
.table tbody tr:hover { background-color: #f9fafb; transform: scale(1.01); }
.table tbody tr:last-child { border-bottom: none; }
.table td { padding: 16px 12px; vertical-align: middle; font-size: 0.95rem; }
.badge { 
    display: inline-flex; 
    align-items: center; 
    gap: 6px; 
    padding: 6px 12px; 
    border-radius: 20px; 
    font-size: 0.875rem; 
    font-weight: 600; 
    white-space: nowrap; 
}
.badge i { font-size: 0.75rem; }
.badge-good { background: rgba(34, 197, 94, 0.15); color: #16a34a; }
.badge-ok { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
.badge-warn { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
.badge-bad { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
.badge-neutral { background: rgba(100, 116, 139, 0.15); color: #64748b; }
.progress-bar-container { 
    width: 100%; 
    height: 24px; 
    background: #e5e7eb; 
    border-radius: 12px; 
    overflow: hidden; 
    position: relative; 
}
.progress-bar-fill { 
    height: 100%; 
    transition: width 0.8s ease-out; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 0.75rem; 
    font-weight: 600; 
    color: white; 
}
.progress-bar-fill.ganga { background: linear-gradient(90deg, #16a34a, #22c55e); }
.progress-bar-fill.compra { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
.progress-bar-fill.justo { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.progress-bar-fill.caro { background: linear-gradient(90deg, #ef4444, #f97316); }
.company-link { 
    color: #1f2937; 
    font-weight: 600; 
    text-decoration: none; 
    transition: color 0.2s; 
    display: flex; 
    align-items: center; 
    gap: 8px; 
}
.company-link:hover { color: #667eea; }
.company-logo { 
    width: 20px; 
    height: 20px; 
    border-radius: 4px; 
    object-fit: contain; 
    background: white; 
    border: 1px solid #e5e7eb; 
    flex-shrink: 0; 
}
.currency-badge { 
    display: inline-block; 
    font-size: 0.75rem; 
    padding: 2px 6px; 
    background: #f3f4f6; 
    color: #6b7280; 
    border-radius: 4px; 
    margin-left: 4px; 
    font-weight: 500; 
}

/* Nuevos estilos para filtros combinables */
.filters-section {
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: 1px solid rgba(30, 64, 175, 0.1);
}

.filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 12px;
}

.filters-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e40af;
    display: flex;
    align-items: center;
    gap: 10px;
}

.filters-actions {
    display: flex;
    gap: 12px;
    align-items: center;
}

.results-counter {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.clear-filters-btn {
    padding: 8px 20px;
    border-radius: 25px;
    border: 2px solid #ef4444;
    background: white;
    color: #ef4444;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
}

.clear-filters-btn:hover {
    background: #ef4444;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.clear-filters-btn:active {
    transform: translateY(0);
}

.filter-group {
    margin-bottom: 20px;
}

.filter-group:last-child {
    margin-bottom: 0;
}

.filter-group-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-buttons { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
}

.filter-btn { 
    padding: 10px 18px; 
    border-radius: 25px; 
    border: 2px solid #e5e7eb; 
    background: white; 
    color: #64748b; 
    font-weight: 600; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
}

.filter-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.filter-btn:hover::before {
    left: 100%;
}

.filter-btn:hover { 
    border-color: #667eea; 
    color: #667eea; 
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.filter-btn.active { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color: white; 
    border-color: transparent; 
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.filter-btn.active:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
}

.stat-number { 
    font-size: 2.5rem; 
    font-weight: 700; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    background-clip: text; 
}
.stat-label { 
    color: #64748b; 
    font-size: 0.875rem; 
    text-transform: uppercase; 
    letter-spacing: 0.05em; 
    font-weight: 600; 
}
.loading-spinner { 
    display: inline-block; 
    width: 40px; 
    height: 40px; 
    border: 4px solid #e5e7eb; 
    border-top-color: #667eea; 
    border-radius: 50%; 
    animation: spin 1s linear infinite; 
}
@keyframes spin { to { transform: rotate(360deg); } }

.header-section { 
    background: white; 
    border-radius: 16px; 
    padding: 32px; 
    margin-bottom: 24px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    border: 1px solid rgba(30, 64, 175, 0.1);
}
.header-title { 
    font-size: 2.5rem; 
    font-weight: 800; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    background-clip: text; 
    margin-bottom: 8px; 
}
.header-subtitle { 
    color: #64748b; 
    font-size: 1.125rem; 
}
.alert-info { 
    background: rgba(59, 130, 246, 0.1); 
    border-left: 4px solid #3b82f6; 
    padding: 16px; 
    border-radius: 8px; 
    margin: 16px 0; 
    color: #1e40af; 
    font-size: 0.875rem; 
}

@media (max-width: 768px) { 
    .table { font-size: 0.75rem; } 
    .table td, .table th { padding: 8px 6px; } 
    .stat-number { font-size: 1.875rem; } 
    .header-title { font-size: 1.875rem; }
    .filters-header { flex-direction: column; align-items: flex-start; }
}

/* Navegación */
nav { 
    background: white; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    position: sticky; 
    top: 0; 
    z-index: 50; 
}
.nav-container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
.nav-content { display: flex; justify-content: space-between; align-items: center; height: 64px; }
.nav-logo { font-size: 1.5rem; font-weight: bold; color: #1e40af; text-decoration: none; }
.nav-logo span { color: #059669; }
.nav-links { display: none; gap: 2rem; }
.nav-link { 
    color: #4b5563; 
    text-decoration: none; 
    font-weight: 500; 
    transition: color 0.2s; 
    position: relative; 
}
.nav-link:hover { color: #1e40af; }
.nav-link::after { 
    content: ''; 
    position: absolute; 
    bottom: -4px; 
    left: 0; 
    width: 0; 
    height: 2px; 
    background: #059669; 
    transition: width 0.3s; 
}
.nav-link:hover::after { width: 100%; }
.nav-link.active { color: #1e40af; }
.mobile-menu-btn { display: block; background: none; border: none; padding: 0.5rem; cursor: pointer; }
.mobile-menu { 
    display: none; 
    position: absolute; 
    top: 100%; 
    left: 0; 
    right: 0; 
    background: white; 
    border-top: 1px solid #e5e7eb; 
    box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
}
.mobile-menu a { 
    display: block; 
    padding: 0.75rem 1rem; 
    color: #4b5563; 
    text-decoration: none; 
    transition: background-color 0.2s; 
}
.mobile-menu a:hover { background-color: #f3f4f6; }

/* Footer Styles */
.footer { 
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%); 
    color: white; 
    margin-top: 60px; 
}
.footer-container { max-width: 1400px; margin: 0 auto; padding: 48px 20px 24px; }
.footer-content { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
    gap: 40px; 
    margin-bottom: 40px; 
}
.footer-section h3 { 
    font-size: 1.125rem; 
    font-weight: 700; 
    margin-bottom: 16px; 
    color: white; 
}
.footer-links { list-style: none; padding: 0; margin: 0; }
.footer-links li { margin-bottom: 12px; }
.footer-links a { 
    color: rgba(255, 255, 255, 0.8); 
    text-decoration: none; 
    transition: color 0.2s; 
    display: inline-flex; 
    align-items: center; 
    gap: 8px; 
}
.footer-links a:hover { color: white; }
.footer-social { display: flex; gap: 12px; margin-top: 16px; }
.footer-social a { 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    width: 40px; 
    height: 40px; 
    background: rgba(255, 255, 255, 0.1); 
    border-radius: 50%; 
    color: white; 
    text-decoration: none; 
    transition: all 0.3s; 
}
.footer-social a:hover { 
    background: rgba(255, 255, 255, 0.2); 
    transform: translateY(-2px); 
}
.footer-bottom { 
    border-top: 1px solid rgba(255, 255, 255, 0.2); 
    padding-top: 24px; 
    text-align: center; 
}
.footer-bottom p { 
    color: rgba(255, 255, 255, 0.8); 
    font-size: 0.875rem; 
    margin: 8px 0; 
}
.footer-disclaimer { 
    background: rgba(0, 0, 0, 0.2); 
    padding: 20px; 
    border-radius: 8px; 
    margin-bottom: 24px; 
    font-size: 0.875rem; 
    line-height: 1.6; 
    color: rgba(255, 255, 255, 0.9); 
}

@media (min-width: 768px) {
    .mobile-menu-btn { display: none; }
    .nav-links { display: flex; }
    .mobile-menu { display: none; }
}

.dashboard-header {
    background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
    color: white;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
    box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
}
.dashboard-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}
.dashboard-subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.125rem;
    margin-bottom: 16px;
}
.dashboard-description {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
    line-height: 1.6;
    max-width: 800px;
}

.legend-container {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-top: 24px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    border: 1px solid rgba(30, 64, 175, 0.1);
}
.legend-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 12px;
}
.legend-color {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    margin-right: 12px;
    flex-shrink: 0;
    margin-top: 2px;
}
.legend-text {
    font-size: 0.9rem;
    color: #4b5563;
    line-height: 1.5;
}
</style>
</head>
<body class="bg-gray-50">
<!-- Navegación -->
<nav class="bg-white shadow-md sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between items-center h-16">
    <div class="flex items-center">
        <a href="/" class="text-2xl font-bold text-primary">
            Renta<span class="text-secondary">DGI</span>
        </a>
    </div>
    <div class="hidden md:flex space-x-8">
        <a href="/" class="nav-link text-gray-700 hover:text-primary font-medium">Inicio</a>
        <a href="/metodologia" class="nav-link text-gray-700 hover:text-primary font-medium">Metodología</a>
        <a href="/dashboard" class="nav-link text-primary font-medium active">Dashboard</a>
        <a href="/analisis" class="nav-link text-gray-700 hover:text-primary font-medium">Análisis</a>
        <a href="/sobre-mi" class="nav-link text-gray-700 hover:text-primary font-medium">Sobre mí</a>
    </div>
    <div class="md:hidden">
        <button class="mobile-menu-btn text-gray-700 hover:text-primary" onclick="toggleMobileMenu()">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>
</div>
</div>
<!-- Menú móvil -->
<div class="mobile-menu" id="mobileMenu">
    <a href="/">Inicio</a>
    <a href="/metodologia">Metodología</a>
    <a href="/dashboard">Dashboard</a>
    <a href="/analisis">Análisis</a>
    <a href="/sobre-mi">Sobre mí</a>
</div>
</nav>

<div class="dashboard-container">
<!-- Header mejorado -->
<div class="dashboard-header">
    <h1 class="dashboard-title">
        <i class="fas fa-chart-line"></i> Dashboard de Inversiones DGI
    </h1>
    <p class="dashboard-subtitle">Análisis en tiempo real de empresas con dividendos crecientes</p>
    <p class="dashboard-description">
        Datos actualizados automáticamente desde Google Sheets. Evalúa empresas según la metodología DGI: 
        flujo de caja, cobertura del dividendo, historial de pagos, calidad del negocio, balance y crecimiento sostenible.
    </p>
    <div class="alert-info mt-4">
        <i class="fas fa-info-circle"></i>
        <strong>Importante:</strong> Datos indicativos. Consulta el análisis completo antes de tomar decisiones de inversión.
    </div>
</div>

<!-- Stats Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px;">
    <div class="stats-card">
        <div class="stat-label">Total Empresas</div>
        <div class="stat-number" id="stat-total">—</div>
    </div>
    <div class="stats-card">
        <div class="stat-label">Oportunidades Ganga</div>
        <div class="stat-number" id="stat-ganga" style="color: #16a34a;">—</div>
    </div>
    <div class="stats-card">
        <div class="stat-label">Zona Compra</div>
        <div class="stat-number" id="stat-compra" style="color: #3b82f6;">—</div>
    </div>
    <div class="stats-card">
        <div class="stat-label">Yield Promedio</div>
        <div class="stat-number" id="stat-yield">—</div>
    </div>
</div>

<!-- Filtros Combinables -->
<div class="filters-section">
    <div class="filters-header">
        <h2 class="filters-title">
            <i class="fas fa-filter"></i> Filtros Combinables
        </h2>
        <div class="filters-actions">
            <div class="results-counter" id="results-counter">
                <i class="fas fa-list-ul"></i>
                <span id="filtered-count">0</span> / <span id="total-count">0</span> empresas
            </div>
            <button class="clear-filters-btn" id="clear-filters" onclick="clearAllFilters()">
                <i class="fas fa-times-circle"></i> Limpiar Filtros
            </button>
        </div>
    </div>
    
    <div class="filter-group">
        <div class="filter-group-title">
            <i class="fas fa-tag"></i> Valoración
        </div>
        <div class="filter-buttons">
            <button class="filter-btn" data-filter-type="decision" data-filter-value="ganga">
                <i class="fas fa-gem"></i> Ganga
            </button>
            <button class="filter-btn" data-filter-type="decision" data-filter-value="compra">
                <i class="fas fa-cart-shopping"></i> Compra
            </button>
            <button class="filter-btn" data-filter-type="decision" data-filter-value="justo">
                <i class="fas fa-balance-scale"></i> Precio Justo
            </button>
        </div>
    </div>
    
    <div class="filter-group">
        <div class="filter-group-title">
            <i class="fas fa-shield-alt"></i> Seguridad del Dividendo
        </div>
        <div class="filter-buttons">
            <button class="filter-btn" data-filter-type="seguridad" data-filter-value="muy-alta">
                <i class="fas fa-star"></i> Muy Alta (≥85)
            </button>
            <button class="filter-btn" data-filter-type="seguridad" data-filter-value="alta">
                <i class="fas fa-check-circle"></i> Alta (70-84)
            </button>
            <button class="filter-btn" data-filter-type="seguridad" data-filter-value="media">
                <i class="fas fa-exclamation-circle"></i> Media (50-69)
            </button>
        </div>
    </div>
    
    <div class="filter-group">
        <div class="filter-group-title">
            <i class="fas fa-star"></i> Métricas de Calidad
        </div>
        <div class="filter-buttons">
            <button class="filter-btn" data-filter-type="score" data-filter-value="muy-alto">
                <i class="fas fa-trophy"></i> Score Excelente (≥8.0)
            </button>
            <button class="filter-btn" data-filter-type="score" data-filter-value="alto">
                <i class="fas fa-star"></i> Score Alto (≥7.5)
            </button>
        </div>
    </div>
    
    <div class="filter-group">
        <div class="filter-group-title">
            <i class="fas fa-percentage"></i> Rentabilidad por Dividendo
        </div>
        <div class="filter-buttons">
            <button class="filter-btn" data-filter-type="yield" data-filter-value="alto">
                <i class="fas fa-percentage"></i> Yield Alto (≥4%)
            </button>
            <button class="filter-btn" data-filter-type="yield" data-filter-value="muy-alto">
                <i class="fas fa-fire"></i> Yield Muy Alto (≥5%)
            </button>
        </div>
    </div>
</div>

<!-- Table -->
<div class="main-table-card">
    <div style="overflow-x: auto;">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 50px;" class="sortable" data-sort="rank" title="Ordenar por Ranking">#</th>
                    <th>Empresa</th>
                    <th style="text-align: center;" class="sortable" data-sort="score" title="Ordenar por Score">Score RentaDGI</th>
                    <th style="text-align: right;">Precio</th>
                    <th style="text-align: center;" class="sortable" data-sort="yield" title="Ordenar por Yield">Yield %</th>
                    <th style="text-align: center;" class="sortable" data-sort="descuento" title="Ordenar por Descuento">vs Compra</th>
                    <th style="width: 200px;">Valoración</th>
                    <th style="text-align: center;" class="sortable" data-sort="seguridad" title="Ordenar por Seguridad">Seguridad</th>
                    <th style="text-align: center;">Decisión</th>
                </tr>
            </thead>
            <tbody id="dashboard-tbody">
                <tr>
                    <td colspan="9" style="text-align: center; padding: 40px;">
                        <div class="loading-spinner" style="margin: 0 auto;"></div>
                        <p style="margin-top: 16px; color: #64748b;">Cargando datos desde Google Sheets...</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Leyenda -->
<div class="legend-container">
    <h3 class="font-bold text-gray-900 mb-3 flex items-center">
        <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> Leyenda
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(90deg, #16a34a, #22c55e);"></div>
            <div class="legend-text"><strong>Valoración:</strong> Porcentaje que le queda hasta el precio Ganga. 100% = ha alcanzado el precio apto para comprar con margen de seguridad.</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e5e7eb;"></div>
            <div class="legend-text"><strong>vs Compra:</strong> Porcentaje que le queda o le falta para alcanzar el precio de compra justa.</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(90deg, #3b82f6, #60a5fa);"></div>
            <div class="legend-text"><strong>Score RentaDGI:</strong> Puntuación calculada mediante los 6 criterios de valoración: Historial de dividendos, Cobertura del dividendo, Solidez financiera, Ventaja competitiva, Diversificación geográfica y Crecimiento de beneficios.</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
            <div class="legend-text"><strong>Seguridad:</strong> Puntuación de seguridad de RentaDGI obtenida mediante los datos clave para medir la seguridad del dividendo.</div>
        </div>
    </div>
</div>
</div>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <!-- Disclaimer -->
        <div class="footer-disclaimer">
            <strong><i class="fas fa-exclamation-triangle"></i> Aviso Legal:</strong> La información proporcionada en RentaDGI.es tiene carácter meramente informativo y educativo. No constituye asesoramiento financiero, fiscal ni de inversión. Las decisiones de inversión son responsabilidad exclusiva del inversor. Se recomienda consultar con un asesor financiero profesional antes de realizar cualquier inversión.
        </div>
        <div class="footer-content">
            <!-- Sección 1: Sobre RentaDGI -->
            <div class="footer-section">
                <h3><i class="fas fa-chart-line"></i> RentaDGI</h3>
                <p style="color: rgba(255, 255, 255, 0.8); line-height: 1.6; margin-bottom: 16px;">
                    Análisis profesional de empresas con dividendos crecientes. Metodología DGI aplicada al mercado español e internacional.
                </p>
                <div class="footer-social">
                    <a href="https://twitter.com/rentadgi" target="_blank" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/rentadgi" target="_blank" title="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="mailto:contacto@rentadgi.es" title="Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
            <!-- Sección 2: Navegación -->
            <div class="footer-section">
                <h3><i class="fas fa-sitemap"></i> Navegación</h3>
                <ul class="footer-links">
                    <li><a href="/"><i class="fas fa-home"></i> Inicio</a></li>
                    <li><a href="/metodologia"><i class="fas fa-book"></i> Metodología DGI</a></li>
                    <li><a href="/dashboard"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                    <li><a href="/analisis"><i class="fas fa-search-dollar"></i> Análisis</a></li>
                    <li><a href="/mi-cartera-dgi"><i class="fas fa-wallet"></i> Mi Cartera</a></li>
                    <li><a href="/sobre-mi"><i class="fas fa-user"></i> Sobre mí</a></li>
                </ul>
            </div>
            <!-- Sección 3: Recursos -->
            <div class="footer-section">
                <h3><i class="fas fa-tools"></i> Recursos</h3>
                <ul class="footer-links">
                    <li><a href="/calculadora-dgi"><i class="fas fa-calculator"></i> Calculadora DGI</a></li>
                    <li><a href="/glosario"><i class="fas fa-book-open"></i> Glosario Financiero</a></li>
                    <li><a href="/analisis"><i class="fas fa-rss"></i> Blog (Análisis)</a></li>
                    <li><a href="/faq"><i class="fas fa-question-circle"></i> Preguntas Frecuentes</a></li>
                </ul>
            </div>
            <!-- Sección 4: Legal -->
            <div class="footer-section">
                <h3><i class="fas fa-balance-scale"></i> Legal</h3>
                <ul class="footer-links">
                    <li><a href="/aviso-legal"><i class="fas fa-file-contract"></i> Aviso Legal</a></li>
                    <li><a href="/politica-privacidad"><i class="fas fa-user-shield"></i> Política de Privacidad</a></li>
                    <li><a href="/cookies"><i class="fas fa-cookie-bite"></i> Política de Cookies</a></li>
                    <li><a href="/terminos-uso"><i class="fas fa-file-alt"></i> Términos de Uso</a></li>
                    <li><a href="/contacto"><i class="fas fa-envelope"></i> Contacto</a></li>
                </ul>
            </div>
        </div>
        <!-- Footer Bottom -->
        <div class="footer-bottom">
            <p><i class="fas fa-sync-alt"></i> Datos actualizados automáticamente desde Google Sheets</p>
            <p>&copy; 2024 RentaDGI.es · Todos los derechos reservados · Desarrollado con <i class="fas fa-heart" style="color: #ef4444;"></i> para inversores DGI</p>
        </div>
    </div>
</footer>

<script>
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

(function() {
"use strict";

var SHEET_ID = "17WKMcAkL8-YnNPbyC01YFm_QcvLfmvEhm8fyslM3Tk8";
var GID = "521257118";

// Mapeo de análisis
var ANALYSIS_URLS = {
    "diageo": "https://rentadgi.es/analisis-dgi-2-diageo-plc-dge-l/",
    "coca-cola": "https://rentadgi.es/analisis-dgi-1-the-coca-cola-company-ko/",
    "coca cola": "https://rentadgi.es/analisis-dgi-1-the-coca-cola-company-ko/",
    "ko": "https://rentadgi.es/analisis-dgi-1-the-coca-cola-company-ko/",
    "johnson": "https://rentadgi.es/analisis-dgi-3-johnson-johnson-jnj/",
    "jnj": "https://rentadgi.es/analisis-dgi-3-johnson-johnson-jnj/",
    "brown-forman": "https://rentadgi.es/analisis-dgi-4-brown-forman-corporation-bf/",
    "bf": "https://rentadgi.es/analisis-dgi-4-brown-forman-corporation-bf/",
    "nike": "https://rentadgi.es/analisis-dgi-5-nike/",
    "nke": "https://rentadgi.es/analisis-dgi-5-nike/"
};

// Mapeo de monedas
var CURRENCY_MAP = {
    "diageo": { symbol: "£", name: "GBX" },
    "dge": { symbol: "£", name: "GBX" },
    "coca-cola": { symbol: "$", name: "USD" },
    "coca cola": { symbol: "$", name: "USD" },
    "ko": { symbol: "$", name: "USD" },
    "johnson": { symbol: "$", name: "USD" },
    "jnj": { symbol: "$", name: "USD" },
    "brown-forman": { symbol: "$", name: "USD" },
    "bf": { symbol: "$", name: "USD" },
    "nike": { symbol: "$", name: "USD" },
    "nke": { symbol: "$", name: "USD" }
};

// Mapeo de logos
var COMPANY_LOGOS = {
    "diageo": "https://logo.clearbit.com/diageo.com",
    "dge": "https://logo.clearbit.com/diageo.com",
    "coca-cola": "https://logo.clearbit.com/coca-cola.com",
    "coca cola": "https://logo.clearbit.com/coca-cola.com",
    "ko": "https://logo.clearbit.com/coca-cola.com",
    "johnson": "https://logo.clearbit.com/jnj.com",
    "jnj": "https://logo.clearbit.com/jnj.com",
    "brown": "https://logo.clearbit.com/brown-forman.com",
    "forman": "https://logo.clearbit.com/brown-forman.com",
    "brown-forman": "https://logo.clearbit.com/brown-forman.com",
    "brown forman": "https://logo.clearbit.com/brown-forman.com",
    "bf": "https://logo.clearbit.com/brown-forman.com",
    "nike": "https://logo.clearbit.com/nike.com",
    "nke": "https://logo.clearbit.com/nike.com"
};

// Estado de filtros activos
var activeFilters = {
    decision: [],
    seguridad: [],
    score: [],
    yield: []
};

function getAnalysisUrl(companyName, urlFromSheet) {
    if (urlFromSheet && urlFromSheet.trim() !== "") {
        if (urlFromSheet.startsWith("http")) {
            return urlFromSheet;
        } else {
            return "https://rentadgi.es/" + urlFromSheet.replace(/^\/+/, "") + "/";
        }
    }
    var normalized = companyName.toLowerCase();
    for (var key in ANALYSIS_URLS) {
        if (normalized.includes(key)) {
            return ANALYSIS_URLS[key];
        }
    }
    return "#";
}

function getCurrency(companyName) {
    var normalized = companyName.toLowerCase();
    for (var key in CURRENCY_MAP) {
        if (normalized.includes(key)) {
            return CURRENCY_MAP[key];
        }
    }
    return { symbol: "$", name: "USD" };
}

function getCompanyLogo(companyName) {
    var normalized = companyName.toLowerCase();
    for (var key in COMPANY_LOGOS) {
        if (normalized.includes(key)) {
            return COMPANY_LOGOS[key];
        }
    }
    return null;
}

function cleanNum(v) {
    if (v == null || v === "") return null;
    var s = (typeof v === "number") ? String(v) : String(v).trim();
    s = s.replace(/[£$€%]/g, "").replace(/\s+/g, "");
    var hasDot = s.indexOf(".") !== -1;
    var hasComma = s.indexOf(",") !== -1;
    if (hasDot && hasComma) {
        var lastDot = s.lastIndexOf(".");
        var lastComma = s.lastIndexOf(",");
        var decIsComma = lastComma > lastDot;
        var decimalSep = decIsComma ? "," : ".";
        var thousandSep = decIsComma ? "." : ",";
        s = s.split(thousandSep).join("");
        s = s.replace(decimalSep, ".");
    } else if (hasComma && !hasDot) {
        s = s.replace(",", ".");
    }
    var n = parseFloat(s);
    return isNaN(n) ? null : n;
}

function fmt(n, decimals, unit) {
    if (n == null || isNaN(n)) return "—";
    var formatted = n.toLocaleString("es-ES", { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
    return unit ? formatted + " " + unit : formatted;
}

function loadDashboardData() {
    var callbackName = "DashboardLoader_" + Date.now() + "_" + Math.random().toString(36).slice(2);
    window[callbackName] = function(response) {
        try {
            var tbody = document.getElementById("dashboard-tbody");
            if (!tbody) return;
            var companies = [];
            var rows = response.table.rows;

            for (var i = 0; i < rows.length; i++) {
                var row = rows[i].c || [];
                if (row.length < 14) continue;
                
                var numero = row[0] ? String(row[0].v || "") : "";
                var empresa = row[1] ? String(row[1].v || "") : "";
                var url = row[2] ? String(row[2].v || "") : "";
                var score = cleanNum(row[3] ? row[3].v : null);
                var precio = cleanNum(row[4] ? row[4].v : null);
                var yieldPct = cleanNum(row[5] ? row[5].v : null);
                var descuento = cleanNum(row[6] ? row[6].v : null);
                var barraPct = cleanNum(row[7] ? row[7].v : null);
                var decision = row[8] ? String(row[8].v || "").toLowerCase().trim() : "";
                var progresoGanga = cleanNum(row[9] ? row[9].v : null);
                var precioCompra = cleanNum(row[10] ? row[10].v : null);
                var precioGanga = cleanNum(row[11] ? row[11].v : null);
                var precioCaro = cleanNum(row[12] ? row[12].v : null);
                var seguridad = cleanNum(row[13] ? row[13].v : null);

                // Normalizar decisión
                if (decision.includes("ganga")) decision = "ganga";
                else if (decision.includes("compra")) decision = "compra";
                else if (decision.includes("justo") || decision.includes("precio")) decision = "justo";
                else if (decision.includes("caro")) decision = "caro";

                // Saltar fila de encabezado
                if (!empresa || empresa.toLowerCase() === "empresa") continue;

                companies.push({
                    numero: numero,
                    empresa: empresa,
                    url: url,
                    score: score,
                    precio: precio,
                    yieldPct: yieldPct,
                    descuento: descuento,
                    barraPct: barraPct,
                    decision: decision,
                    progresoGanga: progresoGanga,
                    precioCompra: precioCompra,
                    precioGanga: precioGanga,
                    precioCaro: precioCaro,
                    seguridad: seguridad
                });
            }

            // Renderizar tabla
            tbody.innerHTML = "";
            companies.forEach(function(comp, idx) {
                var tr = document.createElement("tr");
                tr.setAttribute("data-decision", comp.decision);
                tr.setAttribute("data-seguridad", comp.seguridad);
                tr.setAttribute("data-score", comp.score);
                tr.setAttribute("data-yield", comp.yieldPct);
                tr.setAttribute("data-descuento", comp.descuento);
                tr.setAttribute("data-rank", comp.numero || (idx + 1));

                // Número
                var tdNum = document.createElement("td");
                tdNum.style.textAlign = "center";
                tdNum.style.fontWeight = "600";
                tdNum.style.color = "#9ca3af";
                tdNum.textContent = comp.numero || (idx + 1);
                tr.appendChild(tdNum);

                // Empresa (con logo y enlace)
                var tdEmpresa = document.createElement("td");
                var link = document.createElement("a");
                link.href = getAnalysisUrl(comp.empresa, comp.url);
                link.className = "company-link";
                link.target = "_blank";
                
                var logoUrl = getCompanyLogo(comp.empresa);
                if (logoUrl) {
                    var logo = document.createElement("img");
                    logo.src = logoUrl;
                    logo.className = "company-logo";
                    logo.alt = comp.empresa;
                    logo.onerror = function() { this.style.display = "none"; };
                    link.appendChild(logo);
                }
                
                var nameSpan = document.createElement("span");
                nameSpan.textContent = comp.empresa;
                link.appendChild(nameSpan);
                tdEmpresa.appendChild(link);
                tr.appendChild(tdEmpresa);

                // Score
                var tdScore = document.createElement("td");
                tdScore.style.textAlign = "center";
                if (comp.score != null) {
                    var scoreBadge = document.createElement("span");
                    scoreBadge.className = "badge " + (comp.score >= 7.5 ? "badge-good" : comp.score >= 6 ? "badge-ok" : "badge-warn");
                    scoreBadge.innerHTML = '<i class="fas fa-star"></i> ' + fmt(comp.score, 1);
                    tdScore.appendChild(scoreBadge);
                } else {
                    tdScore.textContent = "—";
                }
                tr.appendChild(tdScore);

                // Precio con moneda
                var tdPrecio = document.createElement("td");
                tdPrecio.style.textAlign = "right";
                tdPrecio.style.fontWeight = "600";
                if (comp.precio != null) {
                    var currency = getCurrency(comp.empresa);
                    var priceText = document.createElement("span");
                    priceText.textContent = fmt(comp.precio, 2) + " ";
                    tdPrecio.appendChild(priceText);
                    var currencyBadge = document.createElement("span");
                    currencyBadge.className = "currency-badge";
                    currencyBadge.textContent = currency.name;
                    tdPrecio.appendChild(currencyBadge);
                } else {
                    tdPrecio.textContent = "—";
                }
                tr.appendChild(tdPrecio);

                // Yield
                var tdYield = document.createElement("td");
                tdYield.style.textAlign = "center";
                tdYield.style.fontWeight = "600";
                tdYield.style.color = "#16a34a";
                tdYield.textContent = comp.yieldPct != null ? fmt(comp.yieldPct, 2, "%") : "—";
                tr.appendChild(tdYield);

                // Descuento vs Compra
                var tdDesc = document.createElement("td");
                tdDesc.style.textAlign = "center";
                if (comp.descuento != null) {
                    var descColor = comp.descuento >= 0 ? "#16a34a" : "#ef4444";
                    tdDesc.style.color = descColor;
                    tdDesc.style.fontWeight = "600";
                    tdDesc.textContent = (comp.descuento >= 0 ? "+" : "") + fmt(comp.descuento, 1, "%");
                } else {
                    tdDesc.textContent = "—";
                }
                tr.appendChild(tdDesc);

                // Barra de Valoración
                var tdBarra = document.createElement("td");
                var progressContainer = document.createElement("div");
                progressContainer.className = "progress-bar-container";
                var position = comp.barraPct != null ? comp.barraPct : 50;
                position = Math.max(0, Math.min(100, position));
                var barClass = "justo";
                if (comp.decision === "ganga") barClass = "ganga";
                else if (comp.decision === "compra") barClass = "compra";
                else if (comp.decision === "caro") barClass = "caro";
                var progressFill = document.createElement("div");
                progressFill.className = "progress-bar-fill " + barClass;
                progressFill.style.width = position + "%";
                progressFill.textContent = Math.round(position) + "%";
                progressContainer.appendChild(progressFill);
                tdBarra.appendChild(progressContainer);
                tr.appendChild(tdBarra);

                // Seguridad
                var tdSeg = document.createElement("td");
                tdSeg.style.textAlign = "center";
                if (comp.seguridad != null) {
                    var segBadge = document.createElement("span");
                    segBadge.className = "badge " + (comp.seguridad >= 85 ? "badge-good" : comp.seguridad >= 70 ? "badge-ok" : comp.seguridad >= 50 ? "badge-warn" : "badge-bad");
                    segBadge.innerHTML = '<i class="fas fa-shield-alt"></i> ' + Math.round(comp.seguridad);
                    tdSeg.appendChild(segBadge);
                } else {
                    tdSeg.textContent = "—";
                }
                tr.appendChild(tdSeg);

                // Decisión
                var tdDec = document.createElement("td");
                tdDec.style.textAlign = "center";
                var decisionBadge = document.createElement("span");
                if (comp.decision === "ganga") {
                    decisionBadge.className = "badge badge-good";
                    decisionBadge.innerHTML = '<i class="fas fa-gem"></i> Ganga';
                } else if (comp.decision === "compra") {
                    decisionBadge.className = "badge badge-ok";
                    decisionBadge.innerHTML = '<i class="fas fa-cart-shopping"></i> Compra';
                } else if (comp.decision === "justo") {
                    decisionBadge.className = "badge badge-warn";
                    decisionBadge.innerHTML = '<i class="fas fa-balance-scale"></i> Justo';
                } else if (comp.decision === "caro") {
                    decisionBadge.className = "badge badge-bad";
                    decisionBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Caro';
                } else {
                    decisionBadge.className = "badge badge-neutral";
                    decisionBadge.innerHTML = '<i class="fas fa-minus"></i> —';
                }
                tdDec.appendChild(decisionBadge);
                tr.appendChild(tdDec);

                tbody.appendChild(tr);
            });

            // Actualizar estadísticas
            document.getElementById("stat-total").textContent = companies.length;
            var gangaCount = companies.filter(function(c) { return c.decision === "ganga"; }).length;
            // Zona Compra incluye tanto empresas en "compra" como empresas en "ganga"
            var compraCount = companies.filter(function(c) { return c.decision === "compra" || c.decision === "ganga"; }).length;
            document.getElementById("stat-ganga").textContent = gangaCount;
            document.getElementById("stat-compra").textContent = compraCount;
            var validYields = companies.filter(function(c) { return c.yieldPct != null; });
            var avgYield = validYields.length > 0 ? validYields.reduce(function(sum, c) { return sum + c.yieldPct; }, 0) / validYields.length : 0;
            document.getElementById("stat-yield").textContent = fmt(avgYield, 2, "%");

            // Actualizar contador de resultados
            document.getElementById("total-count").textContent = companies.length;
            document.getElementById("filtered-count").textContent = companies.length;

            // Setup filters
            setupFilters();
            // Inicializar ordenamiento
            setupSorting();
        } catch (e) {
            console.error("Error procesando datos:", e);
            document.getElementById("dashboard-tbody").innerHTML = '<tr><td colspan="9" style="text-align:center;color:#ef4444;padding:40px;">Error al cargar los datos: ' + e.message + '</td></tr>';
        } finally {
            try { delete window[callbackName]; } catch (_) {}
        }
    };

    var sheetUrl = "https://docs.google.com/spreadsheets/d/" + SHEET_ID + "/gviz/tq?gid=" + GID + "&headers=1&tqx=responseHandler:" + callbackName;
    var script = document.createElement("script");
    script.src = sheetUrl;
    script.onerror = function() {
        document.getElementById("dashboard-tbody").innerHTML = '<tr><td colspan="9" style="text-align:center;color:#ef4444;padding:40px;">Error al conectar con Google Sheets. Verifica que la hoja sea pública.</td></tr>';
        try { delete window[callbackName]; } catch (_) {}
    };
    document.body.appendChild(script);
}

function setupFilters() {
    var buttons = document.querySelectorAll(".filter-btn");
    buttons.forEach(function(btn) {
        btn.addEventListener("click", function() {
            var filterType = btn.getAttribute("data-filter-type");
            var filterValue = btn.getAttribute("data-filter-value");
            
            // Toggle filtro
            btn.classList.toggle("active");
            
            // Actualizar estado de filtros activos
            if (btn.classList.contains("active")) {
                if (!activeFilters[filterType].includes(filterValue)) {
                    activeFilters[filterType].push(filterValue);
                }
            } else {
                var index = activeFilters[filterType].indexOf(filterValue);
                if (index > -1) {
                    activeFilters[filterType].splice(index, 1);
                }
            }
            
            applyFilters();
        });
    });
}

function applyFilters() {
    var rows = document.querySelectorAll("#dashboard-tbody tr");
    var visibleCount = 0;
    
    rows.forEach(function(row) {
        var decision = row.getAttribute("data-decision");
        var seguridad = parseFloat(row.getAttribute("data-seguridad"));
        var score = parseFloat(row.getAttribute("data-score"));
        var yieldPct = parseFloat(row.getAttribute("data-yield"));
        
        var show = true;
        
        // Filtros de decisión (valoración)
        if (activeFilters.decision.length > 0) {
            show = show && activeFilters.decision.includes(decision);
        }
        
        // Filtros de seguridad
        if (activeFilters.seguridad.length > 0) {
            var seguridadMatch = false;
            activeFilters.seguridad.forEach(function(seg) {
                if (seg === "muy-alta" && seguridad >= 85) seguridadMatch = true;
                if (seg === "alta" && seguridad >= 70 && seguridad < 85) seguridadMatch = true;
                if (seg === "media" && seguridad >= 50 && seguridad < 70) seguridadMatch = true;
            });
            show = show && seguridadMatch;
        }
        
        // Filtros de score
        if (activeFilters.score.length > 0) {
            var scoreMatch = false;
            activeFilters.score.forEach(function(s) {
                if (s === "muy-alto" && score >= 8.0) scoreMatch = true;
                if (s === "alto" && score >= 7.5) scoreMatch = true;
            });
            show = show && scoreMatch;
        }
        
        // Filtros de yield
        if (activeFilters.yield.length > 0) {
            var yieldMatch = false;
            activeFilters.yield.forEach(function(y) {
                if (y === "muy-alto" && yieldPct >= 5) yieldMatch = true;
                if (y === "alto" && yieldPct >= 4) yieldMatch = true;
            });
            show = show && yieldMatch;
        }
        
        row.style.display = show ? "" : "none";
        if (show) visibleCount++;
    });
    
    // Actualizar contador
    document.getElementById("filtered-count").textContent = visibleCount;
}

window.clearAllFilters = function() {
    // Resetear estado
    activeFilters = {
        decision: [],
        seguridad: [],
        score: [],
        yield: []
    };
    
    // Remover clases activas
    var buttons = document.querySelectorAll(".filter-btn");
    buttons.forEach(function(btn) {
        btn.classList.remove("active");
    });
    
    // Mostrar todas las filas
    var rows = document.querySelectorAll("#dashboard-tbody tr");
    rows.forEach(function(row) {
        row.style.display = "";
    });
    
    // Actualizar contador
    var totalCount = document.getElementById("total-count").textContent;
    document.getElementById("filtered-count").textContent = totalCount;
};

function setupSorting() {
    var sortableHeaders = document.querySelectorAll(".table thead th.sortable");
    var currentSort = { field: null, direction: 'asc' };
    
    sortableHeaders.forEach(function(header) {
        header.addEventListener("click", function() {
            var sortField = header.getAttribute("data-sort");
            var direction = 'asc';
            
            if (currentSort.field === sortField) {
                direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            }
            
            currentSort = { field: sortField, direction: direction };
            
            // Actualizar clases visuales
            sortableHeaders.forEach(function(h) {
                h.classList.remove('sort-asc', 'sort-desc');
            });
            header.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
            
            sortTable(sortField, direction);
        });
    });
}

function sortTable(sortField, direction) {
    var tbody = document.getElementById("dashboard-tbody");
    var rows = Array.from(tbody.querySelectorAll("tr"));
    
    rows.sort(function(a, b) {
        var aValue = getSortValue(a, sortField);
        var bValue = getSortValue(b, sortField);
        
        if (aValue === null) return 1;
        if (bValue === null) return -1;
        
        if (direction === 'asc') {
            return aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
        } else {
            return aValue < bValue ? 1 : aValue > bValue ? -1 : 0;
        }
    });
    
    rows.forEach(function(row) {
        tbody.appendChild(row);
    });
}

function getSortValue(row, sortField) {
    var value = null;
    switch(sortField) {
        case 'rank':
            value = parseFloat(row.getAttribute("data-rank"));
            break;
        case 'score':
            value = parseFloat(row.getAttribute("data-score"));
            break;
        case 'yield':
            value = parseFloat(row.getAttribute("data-yield"));
            break;
        case 'seguridad':
            value = parseFloat(row.getAttribute("data-seguridad"));
            break;
        case 'descuento':
            value = parseFloat(row.getAttribute("data-descuento"));
            break;
        default:
            return null;
    }
    return isNaN(value) ? null : value;
}

// Cargar datos al iniciar
if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", loadDashboardData);
} else {
    loadDashboardData();
}

})();
</script>
</body>
</html>
